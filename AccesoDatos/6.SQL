CLEAR SCR;
CREATE OR REPLACE TYPE COLEC_HIJOS AS VARRAY(10) OF VARCHAR(30);
/
DROP TABLE EMP6;
CREATE TABLE EMP6 (
IDEMP NUMBER,
NOMBRE VARCHAR(30),
APELLIDO VARCHAR(30),
HIJOS COLEC_HIJOS
);
/
INSERT INTO EMP6 VALUES (1,'FRANCISCO','ELPEPE',COLEC_HIJOS('LUIS','URSULA'));
INSERT INTO EMP6 VALUES (2,'ESPERANZA','GOMEZ',COLEC_HIJOS('JOSE','CARLOS','PEDRO','EDUARDO','SERGIO'));
SELECT E.HIJOS FROM EMP6 E WHERE IDEMP=1;
SELECT E.HIJOS FROM EMP6 E;
DECLARE
V_HIJOS COLEC_HIJOS;
CUENTA NUMBER;
BEGIN
	SELECT E.HIJOS INTO V_HIJOS FROM EMP6 E WHERE E.IDEMP=1;
	CUENTA := V_HIJOS.COUNT;
	DBMS_OUTPUT.PUT_LINE('Total hijos: '||CUENTA);
END;
/
DECLARE
	CURSOR C1 IS SELECT * FROM EMP6;
	V_ID NUMBER;
	V_NOMBRE VARCHAR(30);
	V_APELLIDO VARCHAR(30);
	V_HIJOS COLEC_HIJOS;
BEGIN
	OPEN C1;
	DBMS_OUTPUT.PUT_LINE('SE PROCEDE A NOMBRAR A LOS HIJOS POR EMPLEADO');
	DBMS_OUTPUT.PUT_LINE(' - - - -');
	LOOP
		FETCH C1 INTO V_ID,V_NOMBRE,V_APELLIDO,V_HIJOS;
		EXIT WHEN C1%NOTFOUND;
		DBMS_OUTPUT.PUT_LINE('ID: '||V_ID||' - NOMBRE: '||V_NOMBRE||' - APELLIDO: '||V_APELLIDO);
		FOR I IN V_HIJOS.FIRST .. V_HIJOS.LAST LOOP
			DBMS_OUTPUT.PUT_LINE('EL HIJO: '||I||' - SE LLAMA: '||V_HIJOS(I));
		END LOOP;		
	END LOOP;
END;
/
DECLARE
	CURSOR C1 IS SELECT * FROM EMP6;
	V_ID NUMBER;
	V_NOMBRE VARCHAR(30);
	V_APELLIDO VARCHAR(30);
	V_HIJOS COLEC_HIJOS;
	CUENTA NUMBER;
BEGIN
	OPEN C1;
	DBMS_OUTPUT.PUT_LINE('SE PROCEDE A CONTAR EL NÚMERO DE HIJOS POR EMPLEADO');
	DBMS_OUTPUT.PUT_LINE(' - - - -');
	LOOP
		FETCH C1 INTO V_ID,V_NOMBRE,V_APELLIDO,V_HIJOS;
		EXIT WHEN C1%NOTFOUND;
		DBMS_OUTPUT.PUT_LINE('ID: '||V_ID||' - NOMBRE: '||V_NOMBRE||' - APELLIDO: '||V_APELLIDO);
		CUENTA := V_HIJOS.COUNT;
		DBMS_OUTPUT.PUT_LINE('Total hijos: '||CUENTA);
	END LOOP;
	CLOSE C1;
END;
/
DECLARE
	HIJO COLEC_HIJOS;
BEGIN
	SELECT HIJOS INTO HIJO FROM EMP6 WHERE IDEMP=1;
	FOR I IN HIJO.FIRST .. HIJO.LAST LOOP
		DBMS_OUTPUT.PUT_LINE('EL HIJO: '||I||' - SE LLAMA: '||HIJO(I));
	END LOOP;
	HIJO.EXTEND;
	HIJO(HIJO.LAST) := 'ANTONIO';
	DBMS_OUTPUT.PUT_LINE('HIJOS DESPUES DE AÑADIR');
	DBMS_OUTPUT.PUT_LINE(' - - - -');
	FOR I IN HIJO.FIRST .. HIJO.LAST LOOP
		DBMS_OUTPUT.PUT_LINE('EL HIJO: '||I||' - SE LLAMA: '||HIJO(I));
	END LOOP;
	DBMS_OUTPUT.PUT_LINE('HIJOS DESPUES DE AÑADIR SOLO CON EXTEND');
	DBMS_OUTPUT.PUT_LINE(' - - - -');
	HIJO.EXTEND;
	FOR I IN HIJO.FIRST .. HIJO.LAST LOOP
		DBMS_OUTPUT.PUT_LINE('EL HIJO: '||I||' - SE LLAMA: '||HIJO(I));
	END LOOP;
END;
/

DECLARE
	V_HIJOS COLEC_HIJOS;
	I NUMBER;
	J NUMBER;
	CUENTA NUMBER;
BEGIN
	SELECT HIJOS INTO V_HIJOS FROM EMP6 E WHERE E.IDEMP=1;
	DBMS_OUTPUT.PUT_LINE('HIJOS ANTES DE EXTEND AVANZADO');
	DBMS_OUTPUT.PUT_LINE(' - - - -');	
	FOR I IN V_HIJOS.FIRST .. V_HIJOS.LAST LOOP
		DBMS_OUTPUT.PUT_LINE('EL HIJO: '||I||' SE LLAMA: '||V_HIJOS(I));
	END LOOP;
	DBMS_OUTPUT.PUT_LINE(' - - - -');	
	DBMS_OUTPUT.PUT_LINE('HIJOS DESPUES DE EXTEND AVANZADO');
	DBMS_OUTPUT.PUT_LINE(' - - - -');
	V_HIJOS.EXTEND(3,1);
	FOR I IN V_HIJOS.FIRST .. V_HIJOS.LAST LOOP
		DBMS_OUTPUT.PUT_LINE('EL HIJO: '||I||' SE LLAMA: '||V_HIJOS(I));
	END LOOP;
END;
/

DROP TABLE EMP6_HIJOS;
CREATE TABLE EMP6_HIJOS(
IDEMP NUMBER PRIMARY KEY,
NOMBRE VARCHAR(30),
APELLIDOS VARCHAR(30),
HIJO COLEC_HIJOS
);

INSERT INTO EMP6_HIJOS VALUES (1,'ELPEPE','GUCHULUACO',COLEC_HIJOS('JUAN','PEDRO','ELKK'));
DECLARE
	I COLEC_HIJOS;
BEGIN
	SELECT HIJO INTO I FROM EMP6_HIJOS WHERE IDEMP=1;	
	I.EXTEND;
	I(I.LAST) := 'ANTONIO';
	UPDATE EMP6_HIJOS SET HIJO = I WHERE IDEMP=1;
END;
/
SELECT * FROM USER_VARRAYS;
DESC COLEC_HIJOS;